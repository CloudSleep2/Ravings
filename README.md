# 胡言乱语 Ravings

## 介绍

你说的对，但是《胡言乱语 Ravings》是由 Github@WheatBox 专为 GML 开发的一款可在游戏运行时无需编译即可直接运行的脚本语言（准确点来说，是它的解释器），主要用于 Mod 系统、热更新 等要在运行时增加新内容的情况。

该脚本语言适用于一个被称作「GameMaker」的游戏引擎，在这里，被游戏开发者选中的游戏将被授予「胡言乱语解释器」，引导 Mod 系统之力。你将扮演一位名为「第三方创作者」的神秘角色，在自由的支持 Ravings 的游戏中制作形式多样、功能独特的 Mod，用以扩充游戏内容，增加游戏乐趣——同时，逐步发掘「胡言乱语 Ravings」的真相。

胡言乱语 Ravings 的语法主要参照了 JS，甚至可以说就是山寨出来了个阉割版的 JS 来给 GM 的游戏在运行时用的，所以会 GM 或 JS 的开发者很容易就能上手

## 进度

### GameMaker 版

搁在一边，等 JS 版做完了直接复制过来改改数组、字符串、Map之类的数据结构和相关函数就能用了

至于为啥做了 JS 版，因为 VSCode 写代码体验比 GameMaker 内置的代码编辑器要舒服太多了，而且用 Node.js 或浏览器来进行调试更方便一些

### JavaScript 版

- [x] 运算能力
- [x] 关键字 var 和 赋值
- [x] 关键字 if
- [x] 关键字 else
- [x] 关键字 while
- [x] 关键字 for
- [ ] 关键字 break
- [ ] 关键字 continue
- [ ] 关键字 function 和 函数调用
- [ ] 关键字 return
- [ ] 数组 []
- [ ] 字符串 ""
- [ ] 对象 {}
- [ ] lambda 函数
- [ ] 逗号运算符 ,
- [ ] 注释 // /* */

## 保留关键字

    var 定义变量
    function 定义函数
    if 分歧语句
    else 分歧语句
    for 循环语句
    while 循环语句
    break 终止循环
    continue 跳过一次循环
    return 返回

## 开发中一些问题的解决方案

### 关于每一个元素的格式

每个元素都会以数组的形式存储，[0] = EType.xxx，[1] = 本体

### 关于分段代码

循环遍历每一个符号

检测是否为空格，若是，则跳过

检测是否为单字符的运算符（, . ( ) 等），若是则分段，并继续去执行后续分段检测与处理

检测是否为双字符的运算符的第一个字符（* + - / = | & 等），若是则再判断下一个字符是否与当前字符可构成双字符运算符，若是则分段于一起，若不是则仅分段第一个字符，并去从第二个字符开始再做分段检测与处理

检测是否为数字（0 1 2 3 4 等），若是则继续往后判断字符是否为数字，直至判断到非数字再分段

若以上都不是，则会视为标识符，并继续往后检测字符，直至判断到数字或特殊符号再分段，注意此处分段时会顺便判断是否为保留关键字，若为保留关键字则再做进一步处理

还有一些对于特定字符或关键字做出的特殊处理，例如 ; { } if 等，详情请见 Ravings.CutCode()

### 关于作用域

Ravings.arrVarMaps 是一个 装有 装有 用户定义的rvs变量 的Map 的数组

每一个下标对应着一个层级，层级以 {} 来进行划分，当读取到 { 时建立新层级，读取到 } 时删除最新的层级

### 关于 if else 是如何处理的

详情 Ravings.RunSentence() 的 ifskip 参数，这是一个长度 1 的数组（利用JS和GML中数组的特性，起到类似指针的效果），同时用以输入和输出

该参数作为输出时是为了延续到同一层的下一个 if 或 else

当函数执行的开始，会判断 ifskip[0] 的值并做出反应：

0 = 正常执行

1 = 跳过，因为上一句是 if 且为假

2 = 上上一句为 if 且为假，这句如果是 else 则执行，如果不是则也依然正常执行并设为 0，该条主要为了 if else 和 while 或 for 嵌套

11 = 正常执行，只不过上一句是 if 且为真

10 = 正常执行，只不过上上一句是 if 且为真，所以这句如果是 else 则将 ifskip 设为 21，若不为 else 则设为 0

21 = 跳过，专门给 else 表示的

而之所以 ifskip 在负责执行 Ravings.RunSentence() 的 Ravings.RunCuttedCode() 里定义而非作为 Ravings 类的成员变量定义，是为了让递归时候的每一层都有一个自己的 ifskip，而不会影响到别的层（关于层的解释和处理见【关于作用域】条目）

还有一些小细节方面的处理，具体请见 Ravings.RunSentence() 和 Ravings.RunCuttedCode()

### 关于 while 是如何处理的

详情 Ravings.RunSentence() 的 inloop 参数，这是一个长度会变的数组（为了适用于嵌套循环还不写花括号的场景），同时用以输入和输出

每进入一层循环，inloop.push() 一个新的元素，每结束一层循环，inloop.pop()

该参数作为输出时是为了给调用该函数的 RunCuttedCode() 看的

当函数执行结束后，调用该函数的 RunCuttedCode() 会判断 inloop 最后一位的值并做出反应：

0 = 正常执行

1 = 正常执行，结束后回到上一句，并设为 2（这个 2 是给 for 和 while 看的，如果接下来表达式为假，则设为 3）

2 = 正常执行，下一句为循环，所以结束后设为 1

3 = 跳过，给该函数看的

还有一些小细节方面的处理，具体请见 Ravings.RunSentence() 和 Ravings.RunCuttedCode()
